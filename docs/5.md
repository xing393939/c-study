### Linux系统编程

#### 第 28 章 文件与I/O
1. C标准I/O库函数
  * fopen(3) 调用open(2)打开指定的文件，返回一个文件描述符
  * fgetc(3) I/O缓冲区中能否读到，不能就调用read(2)让内核读取该文件的数据到I/O缓冲区，再读
  * fputc(3) 判断I/O缓冲区是否有空间存，不能就调用write(2)，让内核把I/O缓冲区的内容写回文件
  * fclose(3) 如果I/O缓冲区中还有数据没写回文件，就调用write(2)写回文件，然后调用close(2)关闭文件
1. open、read、write、close等系统函数称为无缓冲I/O函数。写程序应该用标准I/O库函数：
  * 调一个系统调用比调一个用户空间的函数要慢很多
  * 用C标准I/O库函数要时刻注意I/O缓冲区和实际文件有可能不一致，需要管理
  * 网络编程通常直接调用无缓冲I/O函数
1. 所有支持C语言的平台上应该都可以用C标准库函数，标准I/O库函数在头文件stdio.h中声明。系统函数如下：
  * UNIX平台，无缓存I/O函数在头文件unistd.h中声明
  * Windows系统，底层是Win32 API，其中读写文件的系统函数是ReadFile、WriteFile
1. 由open返回的文件描述符一定是该进程尚未使用的最小描述符。程序启动时自动打开文件描述符0、1、2对应stdin、stdout、stderr
1. 进程的三个状态：
  * 执行：CPU在执行，程序计数器里保存着该进程的指令地址，通用寄存器里保存着该进程运算过程的中间结果
  * 就绪：不需要等待什么事件发生，随时都可以执行，但CPU暂时还在执行另一个进程。内核的调度算法是基于优先级和时间片的
  * 阻塞：导致进程阻塞的典型事件有：请求I/O，申请缓冲空间等
1. command > /dev/null 2>&1 #2表示stderr，&1表示stdout的地址
1. ioctl用于向设备发控制和配置命令，如串口的波特率、校验位、停止位
1. 把磁盘文件的一部分直接映射到内存：
  * void *mmap(void *addr, size_t len, int prot, int flag, int filedes, off_t off); #对文件的读写可以直接用指针
  * int munmap(void *addr, size_t len); #解除内存映射
